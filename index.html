<!doctype html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Pages Console</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* macOS Big Sur Palette - Light */
      --bg-gradient-1: #ff9a9e;
      --bg-gradient-2: #fad0c4;
      --bg-gradient-3: #a18cd1;
      --bg-gradient-4: #fbc2eb;
      
      --glass-sidebar: rgba(255, 255, 255, 0.6);
      --glass-content: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(255, 255, 255, 0.4);
      
      --text-primary: #000000;
      --text-secondary: rgba(60, 60, 67, 0.6);
      
      --input-bg: rgba(255, 255, 255, 0.5);
      --input-border: rgba(0, 0, 0, 0.1);
      
      --accent-color: #007AFF; /* System Blue */
      --danger-color: #FF3B30;
      --success-color: #34C759;
      
      --shadow-window: 0 20px 50px rgba(0,0,0,0.15);
      --radius-window: 24px;
      --radius-element: 12px;
    }

    [data-theme="dark"] {
      /* macOS Big Sur Palette - Dark */
      --bg-gradient-1: #0f2027;
      --bg-gradient-2: #203a43;
      --bg-gradient-3: #2c5364;
      --bg-gradient-4: #4b6cb7;

      --glass-sidebar: rgba(30, 30, 30, 0.6);
      --glass-content: rgba(40, 40, 40, 0.7);
      --glass-border: rgba(255, 255, 255, 0.1);

      --text-primary: #FFFFFF;
      --text-secondary: rgba(235, 235, 245, 0.6);

      --input-bg: rgba(0, 0, 0, 0.2);
      --input-border: rgba(255, 255, 255, 0.1);
      
      --shadow-window: 0 20px 50px rgba(0,0,0,0.5);
    }

    * { box-sizing: border-box; transition: background 0.3s ease, color 0.3s ease, border-color 0.3s ease; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(-45deg, var(--bg-gradient-1), var(--bg-gradient-2), var(--bg-gradient-3), var(--bg-gradient-4));
      background-size: 400% 400%;
      animation: aurora 15s ease infinite;
      color: var(--text-primary);
      overflow-x: hidden;
    }

    @keyframes aurora {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* macOS Á™óÂè£È£éÊ†ºÂÆπÂô® */
    .app-window {
      width: 90%;
      max-width: 1200px;
      height: 85vh;
      max-height: 900px;
      display: flex;
      background: transparent;
      border-radius: var(--radius-window);
      box-shadow: var(--shadow-window);
      overflow: hidden;
      position: relative;
      z-index: 10;
      border: 1px solid var(--glass-border);
      flex-direction: row; /* ÈªòËÆ§Ê°åÈù¢Á´ØÊ®™Âêë */
      animation: popIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* Â∑¶‰æßËæπÊ†è (Sidebar) */
    .sidebar {
      width: 320px;
      background: var(--glass-sidebar);
      backdrop-filter: blur(30px) saturate(120%);
      -webkit-backdrop-filter: blur(30px) saturate(120%);
      border-right: 1px solid var(--glass-border);
      padding: 24px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      flex-shrink: 0;
    }

    /* Âè≥‰æßÂÜÖÂÆπÂå∫ (Content) */
    .content-area {
      flex: 1;
      background: var(--glass-content);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      padding: 32px 40px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    /* Ê†áÈ¢òÊ†è */
    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 30px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 20px;
      letter-spacing: -0.5px;
    }

    .brand img {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    /* ‰∏ªÈ¢òÂàáÊç¢ÊåâÈíÆ */
    .theme-btn {
      background: var(--input-bg);
      border: 1px solid var(--glass-border);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    /* Section Ê†∑Âºè */
    .section-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      margin-top: 24px;
    }
    .section-title:first-child { margin-top: 0; }

    /* ËæìÂÖ•Ê°Ü‰∏éË°®Âçï */
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    input, select {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-primary);
      margin-bottom: 12px;
      outline: none;
      font-family: inherit;
    }
    
    input:focus, select:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.2);
    }

    /* ÊåâÈíÆÁ≥ªÁªü */
    .btn {
      width: 100%;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
      margin-top: 8px;
    }
    
    .btn:active { transform: scale(0.98); }

    .btn.primary {
      background: var(--accent-color);
      color: white;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }
    
    .btn.secondary {
      background: var(--input-bg);
      color: var(--text-primary);
      border: 1px solid var(--input-border);
    }

    .btn.success {
      background: var(--success-color);
      color: white;
    }

    .btn.danger {
      background: rgba(255, 59, 48, 0.1);
      color: var(--danger-color);
      border: 1px solid rgba(255, 59, 48, 0.2);
    }
    .btn.danger:hover {
      background: var(--danger-color);
      color: white;
    }

    /* ÂüüÂêçÂàóË°® */
    .domain-list-container {
      background: var(--input-bg);
      border-radius: 12px;
      padding: 8px;
      min-height: 200px;
      margin-bottom: 20px;
      border: 1px solid var(--input-border);
    }

    .domain-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 4px;
      background: transparent;
      transition: background 0.2s;
    }
    
    .domain-item:hover {
      background: rgba(128, 128, 128, 0.1);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 8px;
    }
    .active .status-dot { background: var(--success-color); box-shadow: 0 0 8px var(--success-color); }
    .pending .status-dot { background: #FF9F0A; }

    .domain-actions button {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 6px;
      background: transparent;
      border: 1px solid var(--input-border);
      color: var(--text-secondary);
      cursor: pointer;
    }
    .domain-actions button:hover {
      background: var(--input-bg);
      color: var(--danger-color);
    }

    /* Êó•ÂøóÁªàÁ´Ø */
    .terminal-card {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 20px;
      color: #00ff00;
      font-family: 'Menlo', monospace;
      font-size: 12px;
      height: 150px;
      overflow-y: auto;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* ÁôªÂΩïÈÅÆÁΩ© */
    .login-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: inherit; /* ÁªßÊâø body ËÉåÊôØ */
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(20px);
    }
    
    .login-box {
      width: 360px;
      background: rgba(255,255,255,0.7);
      backdrop-filter: blur(50px);
      padding: 40px;
      border-radius: 24px;
      box-shadow: 0 30px 60px rgba(0,0,0,0.2);
      text-align: center;
      border: 1px solid rgba(255,255,255,0.5);
    }
    [data-theme="dark"] .login-box {
      background: rgba(30,30,30,0.7);
      border-color: rgba(255,255,255,0.1);
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 200;
    }
    .toast {
      background: var(--glass-content);
      backdrop-filter: blur(20px);
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      font-size: 14px;
      border: 1px solid var(--glass-border);
      transform: translateX(120%);
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .toast.show { transform: translateX(0); }

    /* ÁßªÂä®Á´ØÈÄÇÈÖç */
    @media (max-width: 768px) {
      .app-window {
        flex-direction: column;
        height: 100vh;
        width: 100%;
        border-radius: 0;
        max-height: none;
      }
      .sidebar {
        width: 100%;
        height: auto;
        max-height: 40vh;
        border-right: none;
        border-bottom: 1px solid var(--glass-border);
      }
      .content-area {
        padding: 20px;
      }
    }
    
    @keyframes popIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    
    .hidden { display: none !important; }
    .shake { animation: shake 0.4s ease-in-out; }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  </style>
</head>
<body>

  <!-- Toast Notification -->
  <div class="toast-container">
    <div id="toast" class="toast">
      <span id="toastIcon"></span>
      <span id="toastMsg"></span>
    </div>
  </div>

  <!-- ÁôªÂΩïÁïåÈù¢ -->
  <div id="loginScreen" class="login-overlay">
    <div class="login-box">
      <img src="https://image.hyeri.us.kg/icon.png" style="width:80px; height:80px; border-radius:18px; margin-bottom:20px; box-shadow:0 10px 20px rgba(0,0,0,0.2);">
      <h2 style="margin:0 0 10px; font-weight:700;">Console</h2>
      <p style="color:var(--text-secondary); font-size:14px; margin:0 0 24px;">Authentication Required</p>
      
      <input type="password" id="loginPassword" placeholder="Enter Password" style="text-align:center; padding:14px;">
      <div id="errorMsg" style="color:var(--danger-color); font-size:12px; margin-bottom:12px; opacity:0; transition:opacity 0.2s;">Invalid Password</div>
      <button class="btn primary" id="loginBtn" style="padding:14px;">Access Dashboard</button>
    </div>
  </div>

  <!-- ‰∏ªÂ∫îÁî®Á™óÂè£ -->
  <div id="mainScreen" class="app-window hidden">
    
    <!-- Â∑¶‰æßËæπÊ†èÔºöÈÖçÁΩÆ‰∏éÈÄâÊã© -->
    <div class="sidebar">
      <div class="app-header">
        <div class="brand">
          <img src="https://image.hyeri.us.kg/icon.png">
          <span>Pages</span>
        </div>
        <button class="theme-btn" id="themeToggle">‚òÄÔ∏è</button>
      </div>

      <div class="section-title">Configuration</div>
      <label>Account ID</label>
      <input id="accountId" placeholder="ID..." />
      
      <label>Pages Token</label>
      <input id="pagesToken" type="password" placeholder="Token..." />
      
      <label>Zone Token</label>
      <input id="zoneToken" type="password" placeholder="Token..." />
      
      <div style="display:flex; gap:10px; margin-bottom:30px;">
        <button class="btn secondary" id="loadConfigBtn">Load</button>
        <button class="btn primary" id="saveConfigBtn">Save</button>
      </div>

      <div class="section-title">Projects</div>
      <select id="projectSelect">
        <option value="">Select Project...</option>
      </select>
      <button class="btn secondary" id="loadProjectsBtn">Fetch Projects</button>
    </div>

    <!-- Âè≥‰æßÂÜÖÂÆπÂå∫ÔºöÁÆ°ÁêÜ‰∏éÊó•Âøó -->
    <div class="content-area">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h2 style="margin:0; font-size:24px;">Domains</h2>
        <button class="btn secondary" id="refreshDomainsBtn" style="width:auto;">Refresh</button>
      </div>

      <div id="domainList" class="domain-list-container">
        <div style="display:flex; height:100%; align-items:center; justify-content:center; color:var(--text-secondary); min-height:180px;">
          No domains loaded
        </div>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
        <div>
          <label>Add Custom Domain (Auto DNS)</label>
          <div style="display:flex; gap:8px;">
            <input id="addDomainInput" placeholder="e.g. blog.example.com" style="margin:0;" />
            <button class="btn success" id="addDomainBtn" style="width:auto; margin:0;">Add</button>
          </div>
        </div>
        <div>
          <label>Delete Domain</label>
          <div style="display:flex; gap:8px;">
            <input id="removeDomainInput" placeholder="Domain to remove" style="margin:0;" />
            <button class="btn danger" id="removeDomainBtn" style="width:auto; margin:0;">Delete</button>
          </div>
        </div>
      </div>

      <div class="section-title">System Log</div>
      <div id="output" class="terminal-card">Ready...</div>
    </div>

  </div>

  <script>
    // --- UI Interactions ---
    
    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    const htmlEl = document.documentElement;
    themeToggle.addEventListener('click', () => {
      const current = htmlEl.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      htmlEl.setAttribute('data-theme', next);
      themeToggle.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    });

    // Toast System
    const toastEl = document.getElementById('toast');
    const toastIcon = document.getElementById('toastIcon');
    const toastMsg = document.getElementById('toastMsg');
    let toastTimer;

    function showToast(message, type = 'info') {
      clearTimeout(toastTimer);
      toastMsg.textContent = message;
      
      if(type === 'success') toastIcon.innerHTML = '‚úÖ';
      else if(type === 'error') toastIcon.innerHTML = '‚õî';
      else toastIcon.innerHTML = '‚ÑπÔ∏è';

      toastEl.classList.add('show');
      toastTimer = setTimeout(() => toastEl.classList.remove('show'), 3000);
    }

    // Login Animation
    const loginBox = document.querySelector('.login-box');
    const loginError = document.getElementById('errorMsg');
    
    function triggerLoginError() {
      loginError.style.opacity = '1';
      loginBox.classList.remove('shake');
      void loginBox.offsetWidth;
      loginBox.classList.add('shake');
    }

    // --- Core Logic (Identical to original) ---
    
    const loginScreen=document.getElementById('loginScreen');
    const mainScreen=document.getElementById('mainScreen');
    const loginPassword=document.getElementById('loginPassword');
    const loginBtn=document.getElementById('loginBtn');
    // errorMsg is handled above

    async function checkLogin(){
      const password=loginPassword.value.trim();
      if(!password){
        triggerLoginError();
        return;
      }
      try{
        const resp=await fetch('/api/auth',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({password})
        });
        const data=await resp.json();
        if(data.success){
          sessionStorage.setItem('authenticated','true');
          showMainScreen();
        }else{
          triggerLoginError();
        }
      }catch(e){
        triggerLoginError();
      }
    }

    function showMainScreen(){
      loginScreen.style.opacity = '0';
      setTimeout(() => {
        loginScreen.classList.add('hidden');
        mainScreen.classList.remove('hidden');
        loadConfig();
      }, 300);
    }

    loginBtn.addEventListener('click',checkLogin);
    loginPassword.addEventListener('keypress',e=>{
      if(e.key==='Enter')checkLogin();
    });

    if(sessionStorage.getItem('authenticated')==='true'){
      loginScreen.classList.add('hidden');
      mainScreen.classList.remove('hidden');
      loadConfig();
    }

    // --- Business Logic ---

    const accountId=document.getElementById('accountId');
    const pagesToken=document.getElementById('pagesToken');
    const zoneToken=document.getElementById('zoneToken');
    const projectSelect=document.getElementById('projectSelect');
    const loadProjectsBtn=document.getElementById('loadProjectsBtn');
    const domainList=document.getElementById('domainList');
    const addDomainInput=document.getElementById('addDomainInput');
    const addDomainBtn=document.getElementById('addDomainBtn');
    const removeDomainInput=document.getElementById('removeDomainInput');
    const removeDomainBtn=document.getElementById('removeDomainBtn');
    const refreshDomainsBtn=document.getElementById('refreshDomainsBtn');
    const saveConfigBtn=document.getElementById('saveConfigBtn');
    const loadConfigBtn=document.getElementById('loadConfigBtn');
    const output=document.getElementById('output');

    async function apiCall(path,method='GET',body=null){
      output.innerHTML += `<div>> Req: ${method} ${path}</div>`;
      output.scrollTop = output.scrollHeight;
      try{
        const resp=await fetch(path,{
          method,
          headers:{
            'Content-Type':'application/json',
            'X-Account-Id':accountId.value.trim(),
            'X-Pages-Token':pagesToken.value.trim(),
            'X-Zone-Token':zoneToken.value.trim()
          },
          body:body?JSON.stringify(body):null
        });
        const data=await resp.json().catch(()=>({error:'Invalid JSON response'}));
        output.innerHTML += `<div style="color:${resp.ok?'var(--success-color)':'var(--danger-color)'}">> Resp: ${data.success?'OK':'FAIL'}</div>`;
        output.scrollTop = output.scrollHeight;
        return{ok:resp.ok,data};
      }catch(e){
        output.innerHTML += `<div style="color:var(--danger-color)">> Error: ${e.message}</div>`;
        return{ok:false,data:null};
      }
    }

    async function saveConfig(){
      const config={
        accountId:accountId.value.trim(),
        pagesToken:pagesToken.value.trim(),
        zoneToken:zoneToken.value.trim()
      };
      if(!config.accountId||!config.pagesToken||!config.zoneToken){
        showToast('Please fill in all fields', 'error');
        return;
      }
      const res=await fetch('/api/config',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(config)
      });
      const data=await res.json();
      if(data.success){
        showToast('Config Saved', 'success');
      }else{
        showToast('Save Failed', 'error');
      }
    }

    async function loadConfig(){
      const res=await fetch('/api/config');
      const data=await res.json();
      if(data.success&&data.config){
        accountId.value=data.config.accountId||'';
        pagesToken.value=data.config.pagesToken||'';
        zoneToken.value=data.config.zoneToken||'';
        output.innerHTML += `<div>> Config loaded from cloud</div>`;
      }
    }

    async function loadProjects(){
      const acc=accountId.value.trim();
      if(!acc||!pagesToken.value.trim()) return showToast('Missing Account ID or Token', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects`);
      if(res.ok&&res.data.success){
        const projects=res.data.result||[];
        projectSelect.innerHTML=projects.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');
        if(projects.length>0){
          proj
