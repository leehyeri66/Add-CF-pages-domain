<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CF Pages åŸŸåç®¡ç†å¢å¼ºç‰ˆ</title>
  <style>
    :root{
      --orange:#F48120;
      --orange-dark:#EA700F;
      --yellow:#FAAD3F;
      --arsenic:#404041;
      --white:#fff;
      --bg:#F7F7F8;
      --text:#1f2937;
      --muted:#6b7280;
      --card:#fff;
      --shadow:0 6px 28px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;
      color:var(--text);
      background:linear-gradient(135deg,var(--orange) 0%,#FA6B1D 60%,var(--orange-dark) 100%);
    }
    .container{max-width:1100px;margin:0 auto;padding:28px;}
    .header{text-align:center;color:var(--white);margin-bottom:28px;}
    .header h1{font-size:28px;margin:0 0 6px;letter-spacing:.5px;text-shadow:0 2px 6px rgba(0,0,0,.25);}
    .header p{margin:0;opacity:.95;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
    .card{background:var(--card);border-radius:14px;padding:20px;box-shadow:var(--shadow);border:1px solid #eaeaea;margin-bottom:16px;}
    .card-header{display:flex;align-items:center;justify-content:space-between;font-weight:700;color:var(--arsenic);margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #eef2f7;}
    .section-title{font-weight:700;color:#374151;margin:0 0 12px;font-size:16px;}
    label{display:block;font-weight:600;color:#374151;margin-bottom:6px;font-size:14px;}
    input,select{width:100%;padding:12px 14px;font-size:14px;border-radius:8px;border:1.5px solid #e2e8f0;background:#fff;transition:border-color .2s,box-shadow .2s;}
    input:focus,select:focus{outline:none;border-color:var(--orange);box-shadow:0 0 0 4px rgba(244,129,32,.15);}
    .btn{width:100%;padding:12px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:700;color:white;background:linear-gradient(135deg,var(--orange) 0%,#F59D3B 100%);transition:transform .2s,box-shadow .2s;margin-top:10px;}
    .btn:hover{transform:translateY(-1px);}
    .btn.secondary{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:#fff;}
    .btn.danger{background:linear-gradient(135deg,#f87171 0%,#f43f5e 100%);}
    .btn:focus{outline:none;}
    .domain-item{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:8px;background:#f9f9f9;margin-bottom:6px;border:1px solid #eee;}
    .domain-name{font-weight:600;color:#374151;flex:1;}
    .domain-status{font-size:12px;padding:2px 8px;border-radius:4px;margin:0 8px;}
    .status-active{background:#d1fae5;color:#065f46;}
    .status-pending{background:#fef3c7;color:#92400e;}
    .domain-actions{display:flex;gap:8px;}
    .domain-actions button{padding:6px 12px;font-size:12px;border-radius:6px;border:0;cursor:pointer;background:#f87171;color:white;}
    .output{white-space:pre-wrap;background:#111;color:#e5e7eb;padding:12px;border-radius:8px;min-height:120px;font-size:13px;line-height:1.5;}
    .divider{height:1px;background:#eee;margin:14px 0;}
    .info-box{background:#eff6ff;border-left:4px solid #3b82f6;padding:12px;border-radius:6px;font-size:13px;color:#1e40af;margin-bottom:12px;}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>â˜ï¸ Cloudflare Pages åŸŸåç®¡ç†å¢å¼ºç‰ˆ</h1>
      <p>è‡ªåŠ¨åˆ›å»º DNS è®°å½• + åŸŸåç»‘å®šä¸€æ­¥åˆ°ä½</p>
    </div>

    <div class="card">
      <div class="section-title">ğŸ”‘ API é…ç½®</div>
      <div class="info-box">
        ğŸ’¡ API Token éœ€è¦æƒé™ï¼šAccount.Cloudflare Pages:Edit + Zone.DNS:Edit
      </div>
      <label>Account ID
        <input id="accountId" placeholder="ä½ çš„ Cloudflare Account ID"/>
      </label>
      <label style="margin-top:12px;">API Token
        <input id="apiToken" type="password" placeholder="ä½ çš„ Cloudflare API Token"/>
      </label>
    </div>

    <div class="grid">
      <div class="card">
        <div class="card-header"><span>Pages é¡¹ç›®</span></div>
        <div style="display:flex;gap:10px;">
          <select id="projectSelect" style="flex:1;">
            <option value="">-- å…ˆåŠ è½½é¡¹ç›® --</option>
          </select>
          <button class="btn secondary" id="loadProjectsBtn" style="flex:0 0 auto;width:auto;margin:0;">åŠ è½½</button>
        </div>
        <button class="btn" id="refreshDomainsBtn">åˆ·æ–°åŸŸååˆ—è¡¨</button>
      </div>

      <div class="card">
        <div class="section-title">å·²ç»‘å®šåŸŸå</div>
        <div id="domainList"></div>
        
        <div class="divider"></div>
        
        <label>æ–°å¢åŸŸåï¼ˆè‡ªåŠ¨åˆ›å»º DNSï¼‰
          <input id="addDomainInput" placeholder="ä¾‹å¦‚: sub.hyeri.us.kg"/>
        </label>
        <button class="btn" id="addDomainBtn">æ·»åŠ åŸŸå + åˆ›å»º DNS</button>
        
        <div class="divider"></div>
        
        <label>åˆ é™¤åŸŸå
          <input id="removeDomainInput" placeholder="ä¾‹å¦‚: sub.hyeri.us.kg"/>
        </label>
        <button class="btn danger" id="removeDomainBtn">åˆ é™¤åŸŸå</button>
      </div>
    </div>

    <div class="card">
      <div class="section-title">ğŸ“¡ API å“åº”</div>
      <pre id="output" class="output">ç­‰å¾…æ“ä½œ...</pre>
    </div>
  </div>

  <script>
    const accountIdInput = document.getElementById('accountId');
    const apiTokenInput = document.getElementById('apiToken');
    const projectSelect = document.getElementById('projectSelect');
    const loadProjectsBtn = document.getElementById('loadProjectsBtn');
    const domainList = document.getElementById('domainList');
    const addDomainInput = document.getElementById('addDomainInput');
    const addDomainBtn = document.getElementById('addDomainBtn');
    const removeDomainInput = document.getElementById('removeDomainInput');
    const removeDomainBtn = document.getElementById('removeDomainBtn');
    const refreshDomainsBtn = document.getElementById('refreshDomainsBtn');
    const output = document.getElementById('output');

    function getConfig() {
      const accountId = accountIdInput.value.trim();
      const apiToken = apiTokenInput.value.trim();
      if (!accountId || !apiToken) {
        alert('è¯·å…ˆå¡«å†™ Account ID å’Œ API Token');
        return null;
      }
      return { accountId, apiToken };
    }

    async function apiCall(path, method = 'GET', body = null) {
      output.textContent = 'â³ è¯·æ±‚ä¸­...';
      const config = getConfig();
      if (!config) return { ok: false, data: null };

      try {
        const resp = await fetch(path, {
          method,
          headers: { 
            'Content-Type': 'application/json',
            'X-Account-Id': config.accountId,
            'X-Api-Token': config.apiToken
          },
          body: body ? JSON.stringify(body) : null
        });
        const data = await resp.json().catch(() => ({ error: 'æ— æ•ˆå“åº”' }));
        output.textContent = JSON.stringify(data, null, 2);
        return { ok: resp.ok, data };
      } catch (e) {
        output.textContent = 'âŒ é”™è¯¯: ' + e.message;
        return { ok: false, data: null };
      }
    }

    async function loadProjects() {
      const config = getConfig();
      if (!config) return;
      
      const res = await apiCall(`/api/accounts/${encodeURIComponent(config.accountId)}/projects`);
      
      if (res.ok && res.data.success) {
        const projects = res.data.result || [];
        projectSelect.innerHTML = projects.map(p => 
          `<option value="${p.name}">${p.name}</option>`
        ).join('');
        
        if (projects.length > 0) {
          projectSelect.value = projects[0].name;
          await loadDomains();
        }
      }
    }

    async function loadDomains() {
      const config = getConfig();
      if (!config) return;
      const projectName = projectSelect.value;
      if (!projectName) return;
      
      const res = await apiCall(
        `/api/accounts/${encodeURIComponent(config.accountId)}/projects/${encodeURIComponent(projectName)}/domains`
      );
      
      domainList.innerHTML = '';
      
      if (res.ok && res.data.success) {
        const domains = res.data.result || [];
        
        if (domains.length === 0) {
          domainList.innerHTML = '<div style="color:#555;padding:8px;">æš‚æ— ç»‘å®šåŸŸå</div>';
        } else {
          domains.forEach(d => {
            const statusClass = d.status === 'active' ? 'status-active' : 'status-pending';
            const statusText = d.status === 'active' ? 'âœ“ å·²æ¿€æ´»' : 'â³ éªŒè¯ä¸­';
            
            const el = document.createElement('div');
            el.className = 'domain-item';
            el.innerHTML = `
              <span class="domain-name">${d.name}</span>
              <span class="domain-status ${statusClass}">${statusText}</span>
              <div class="domain-actions">
                <button onclick="confirmAndRemove('${encodeURIComponent(d.name)}')">åˆ é™¤</button>
              </div>
            `;
            domainList.appendChild(el);
          });
        }
      }
    }

    window.confirmAndRemove = async function(domainEncoded) {
      const domain = decodeURIComponent(domainEncoded);
      if (!confirm(`ç¡®å®šåˆ é™¤åŸŸå ${domain}?`)) return;
      
      const config = getConfig();
      if (!config) return;
      const projectName = projectSelect.value;
      
      const res = await apiCall(
        `/api/accounts/${encodeURIComponent(config.accountId)}/projects/${encodeURIComponent(projectName)}/domains/${domain}`,
        'DELETE'
      );
      
      if (res.ok && res.data.success) {
        await loadDomains();
        alert('âœ… åˆ é™¤æˆåŠŸ');
      }
    };

    addDomainBtn.addEventListener('click', async () => {
      const config = getConfig();
      if (!config) return;
      
      const projectName = projectSelect.value;
      const domain = addDomainInput.value.trim();
      
      if (!projectName || !domain) {
        return alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
      }
      
      const res = await apiCall(
        `/api/accounts/${encodeURIComponent(config.accountId)}/projects/${encodeURIComponent(projectName)}/domains`,
        'POST',
        { 
          name: domain,
          create_dns: true
        }
      );
      
      if (res.ok && res.data.success) {
        addDomainInput.value = '';
        await loadDomains();
        alert('âœ… åŸŸåæ·»åŠ æˆåŠŸï¼DNS è®°å½•å·²è‡ªåŠ¨åˆ›å»º');
      } else {
        alert('âŒ æ“ä½œå¤±è´¥ï¼Œè¯·æŸ¥çœ‹ API å“åº”');
      }
    });

    removeDomainBtn.addEventListener('click', async () => {
      const config = getConfig();
      if (!config) return;
      
      const projectName = projectSelect.value;
      const domain = removeDomainInput.value.trim();
      
      if (!projectName || !domain) {
        return alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');
      }
      
      const res = await apiCall(
        `/api/accounts/${encodeURIComponent(config.accountId)}/projects/${encodeURIComponent(projectName)}/domains/${domain}`,
        'DELETE'
      );
      
      if (res.ok && res.data.success) {
        removeDomainInput.value = '';
        await loadDomains();
        alert('âœ… åˆ é™¤æˆåŠŸ');
      } else {
        alert('âŒ åˆ é™¤å¤±è´¥ï¼Œè¯·æŸ¥çœ‹ API å“åº”');
      }
    });

    refreshDomainsBtn.addEventListener('click', loadDomains);
    loadProjectsBtn.addEventListener('click', loadProjects);
    projectSelect.addEventListener('change', loadDomains);
  </script>
</body>
</html>
