<!doctype html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>iCloud Pages æ§åˆ¶å°</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Apple iCloud é£æ ¼é…è‰² - Light */
      /* æ¨¡æ‹Ÿæ¸…æ™¨å¤©ç©ºçš„æ¸å˜ */
      --bg-gradient: linear-gradient(180deg, #F0F8FF 0%, #FFFFFF 60%, #F5F7FA 100%);
      
      --glass-sidebar: rgba(255, 255, 255, 0.5);
      --glass-content: rgba(255, 255, 255, 0.8);
      --glass-border: rgba(255, 255, 255, 0.6);
      
      --text-primary: #1d1d1f;
      --text-secondary: #86868b;
      
      --input-bg: rgba(255, 255, 255, 0.6);
      --input-border: rgba(0, 0, 0, 0.05);
      
      /* Apple System Colors */
      --accent-blue: #007AFF;
      --accent-glow: 0 0 20px rgba(0, 122, 255, 0.25);
      
      --danger-color: #FF3B30;
      --success-color: #34C759;
      
      --shadow-window: 0 20px 50px rgba(0, 0, 0, 0.08);
      --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.03);
      
      --radius-window: 24px;
      --radius-element: 14px;
    }

    [data-theme="dark"] {
      /* Apple Midnight é£æ ¼ - Dark */
      /* æ¨¡æ‹Ÿæ·±å¤œæ˜Ÿç©ºçš„æ¸å˜ */
      --bg-gradient: linear-gradient(180deg, #1c1c1e 0%, #000000 100%);
      
      --glass-sidebar: rgba(30, 30, 30, 0.5);
      --glass-content: rgba(20, 20, 20, 0.6);
      --glass-border: rgba(255, 255, 255, 0.08);
      
      --text-primary: #F5F5F7;
      --text-secondary: #86868b;
      
      --input-bg: rgba(255, 255, 255, 0.08);
      --input-border: transparent;
      
      --accent-blue: #0A84FF;
      --accent-glow: 0 0 25px rgba(10, 132, 255, 0.3);
      
      --shadow-window: 0 30px 60px rgba(0, 0, 0, 0.5);
    }

    * { box-sizing: border-box; transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1); }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-gradient);
      color: var(--text-primary);
      overflow: hidden;
    }

    /* æ¨¡æ‹Ÿäº‘å½©æµåŠ¨çš„ææ·¡èƒŒæ™¯åŠ¨ç”» */
    body::before {
      content: '';
      position: absolute;
      top: -50%; left: -50%; width: 200%; height: 200%;
      background: radial-gradient(circle at center, rgba(0,122,255,0.03) 0%, transparent 60%);
      animation: breathe 10s ease-in-out infinite alternate;
      z-index: 0;
      pointer-events: none;
    }
    @keyframes breathe { from { transform: scale(1); } to { transform: scale(1.1); } }

    /* ä¸»çª—å£å®¹å™¨ */
    .app-window {
      width: 90%;
      max-width: 1100px;
      height: 85vh;
      max-height: 850px;
      display: flex;
      /* è¶…çº§ç£¨ç ‚ç»ç’ƒ */
      background: var(--glass-sidebar);
      backdrop-filter: blur(60px) saturate(180%);
      -webkit-backdrop-filter: blur(60px) saturate(180%);
      border-radius: var(--radius-window);
      box-shadow: var(--shadow-window);
      border: 1px solid var(--glass-border);
      position: relative;
      z-index: 10;
      flex-direction: row;
      opacity: 0;
      transform: scale(0.96) translateY(10px);
      animation: openApp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }

    @keyframes openApp {
      to { opacity: 1; transform: scale(1) translateY(0); }
    }

    /* ä¾§è¾¹æ  */
    .sidebar {
      width: 290px;
      /* å³ä¾§åªæœ‰æç»†çš„åˆ†å‰²çº¿ */
      border-right: 1px solid var(--glass-border);
      padding: 32px 24px;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    /* å“ç‰ŒåŒº */
    .brand-area {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 32px;
    }

    .brand-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      object-fit: cover;
      /* iCloud é£æ ¼çš„å›¾æ ‡é˜´å½± */
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .brand-text {
      font-weight: 600;
      font-size: 17px;
      letter-spacing: -0.3px;
    }

    /* è¡¨å•å…ƒç´  */
    .form-group { margin-bottom: 20px; }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 8px;
      padding-left: 2px;
    }

    input, select {
      width: 100%;
      padding: 12px 14px;
      font-size: 14px;
      border-radius: var(--radius-element);
      border: 1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text-primary);
      outline: none;
      font-family: inherit;
    }

    input:focus, select:focus {
      background: var(--input-bg);
      box-shadow: 0 0 0 2px var(--accent-blue); /* èšç„¦æ—¶åªæœ‰ä¸€åœˆçº¯å‡€çš„è“ */
    }

    /* æŒ‰é’® - Apple é£æ ¼ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 18px;
      border-radius: 50px; /* èƒ¶å›ŠæŒ‰é’® */
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      border: none;
      transition: all 0.2s;
    }

    .btn:active { transform: scale(0.96); }

    .btn.primary {
      background: var(--accent-blue);
      color: white;
      box-shadow: var(--accent-glow);
    }
    .btn.primary:hover { filter: brightness(1.05); }

    .btn.secondary {
      background: rgba(128,128,128,0.1);
      color: var(--accent-blue);
    }
    .btn.secondary:hover { background: rgba(128,128,128,0.15); }

    .btn.danger {
      background: rgba(255, 59, 48, 0.1);
      color: var(--danger-color);
    }
    .btn.danger:hover { background: var(--danger-color); color: white; }

    /* åº•éƒ¨å·¥å…· */
    .sidebar-footer {
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 20px;
    }
    
    .theme-toggle {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: none;
      background: rgba(128,128,128,0.1);
      color: var(--text-primary);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      font-size: 16px;
    }

    /* å†…å®¹åŒº */
    .content-area {
      flex: 1;
      background: var(--glass-content);
      padding: 40px 50px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }

    .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    .header-bar h2 { font-size: 26px; font-weight: 600; margin: 0; }

    /* åˆ—è¡¨å¡ç‰‡ - æµ®å²›è®¾è®¡ */
    .list-card {
      background: rgba(255,255,255,0.4);
      border-radius: 18px;
      padding: 10px;
      min-height: 220px;
      margin-bottom: 30px;
      border: 1px solid var(--glass-border);
      overflow-y: auto;
      box-shadow: var(--shadow-card);
    }
    [data-theme="dark"] .list-card { background: rgba(255,255,255,0.05); }

    .list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 20px;
      margin-bottom: 6px;
      border-radius: 12px;
      background: transparent;
      transition: background 0.2s;
    }
    .list-item:hover { background: rgba(128,128,128,0.08); }

    .status-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 10px;
      font-weight: 600;
      margin-left: 12px;
      display: flex;
      align-items: center; gap: 4px;
    }
    /* æ¨¡ä»¿ iOS çŠ¶æ€ç‚¹ */
    .status-badge::before { content: ''; display: block; width: 6px; height: 6px; border-radius: 50%; }
    
    .badge-active { color: var(--success-color); background: rgba(52, 199, 89, 0.1); }
    .badge-active::before { background: var(--success-color); }
    
    .badge-pending { color: #FF9F0A; background: rgba(255, 159, 10, 0.1); }
    .badge-pending::before { background: #FF9F0A; }

    /* æ“ä½œç½‘æ ¼ */
    .grid-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }
    .action-panel {
      padding: 20px;
      background: rgba(255,255,255,0.4);
      border-radius: 18px;
      border: 1px solid var(--glass-border);
    }
    [data-theme="dark"] .action-panel { background: rgba(255,255,255,0.05); }

    /* ç»ˆç«¯æ—¥å¿— */
    .log-box {
      background: #F5F7FA;
      color: #333;
      padding: 20px;
      border-radius: 14px;
      font-family: 'Menlo', monospace;
      font-size: 12px;
      line-height: 1.6;
      height: 120px;
      overflow-y: auto;
      border: 1px solid rgba(0,0,0,0.05);
    }
    [data-theme="dark"] .log-box { background: #151515; color: #a1a1a1; border-color: rgba(255,255,255,0.1); }

    /* ç™»å½•è¦†ç›– */
    .login-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(240, 248, 255, 0.8);
      backdrop-filter: blur(20px);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    [data-theme="dark"] .login-overlay { background: rgba(0,0,0,0.6); }
    
    .login-card {
      width: 320px;
      background: rgba(255, 255, 255, 0.9);
      padding: 40px;
      border-radius: 28px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      text-align: center;
      transform: scale(1);
    }
    [data-theme="dark"] .login-card { background: #1c1c1e; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }

    /* çµåŠ¨å²› Toast */
    .island-toast {
      position: fixed;
      top: 24px; left: 50%; transform: translateX(-50%) translateY(-150%);
      background: black;
      color: white;
      padding: 12px 24px;
      border-radius: 100px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      font-weight: 500;
      z-index: 200;
      transition: all 0.5s cubic-bezier(0.19, 1, 0.22, 1);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .island-toast.show { transform: translateX(-50%) translateY(0); }
    [data-theme="dark"] .island-toast { background: white; color: black; }

    /* ç§»åŠ¨é€‚é… */
    @media (max-width: 768px) {
      .app-window { flex-direction: column; width: 100%; height: 100%; border-radius: 0; border: none; }
      .sidebar { width: 100%; height: auto; border-right: none; border-bottom: 1px solid var(--glass-border); padding: 24px; }
      .content-area { padding: 24px; }
      .grid-actions { grid-template-columns: 1fr; }
    }

    .hidden { display: none !important; }
    .shake { animation: shake 0.4s; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
  </style>
</head>
<body>

  <!-- çµåŠ¨å²›é€šçŸ¥ -->
  <div id="toast" class="island-toast">
    <span id="toastIcon"></span>
    <span id="toastMsg">Notification</span>
  </div>

  <!-- ç™»å½•ç•Œé¢ -->
  <div id="loginScreen" class="login-overlay">
    <div class="login-card">
      <img src="https://image.hyeri.us.kg/icon.png" style="width:80px; height:80px; border-radius:18px; margin-bottom:24px; box-shadow:0 8px 16px rgba(0,0,0,0.1);">
      <h3 style="margin:0 0 8px; font-weight:600;">èº«ä»½éªŒè¯</h3>
      <p style="color:var(--text-secondary); font-size:13px; margin:0 0 24px;">Cloudflare Pages ç®¡ç†ä¸­å¿ƒ</p>
      
      <input type="password" id="loginPassword" placeholder="è¾“å…¥è®¿é—®å¯†ç " style="text-align:center; margin-bottom:16px; background:rgba(128,128,128,0.08);">
      <button id="loginBtn" class="btn primary" style="width:100%; height:44px;">è¿›å…¥æ§åˆ¶å°</button>
      <div id="errorMsg" style="color:var(--danger-color); font-size:12px; margin-top:16px; opacity:0;">å¯†ç é”™è¯¯</div>
    </div>
  </div>

  <!-- ä¸»åº”ç”¨çª—å£ -->
  <div id="mainScreen" class="app-window hidden">
    
    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar">
      <div class="brand-area">
        <img src="https://image.hyeri.us.kg/icon.png" class="brand-icon">
        <div class="brand-text">iCloud Pages</div>
      </div>

      <div style="flex:1; overflow-y:auto;">
        <div class="form-group">
          <label>è´¦æˆ· ID</label>
          <input id="accountId" placeholder="Cloudflare Account ID" />
        </div>
        <div class="form-group">
          <label>Pages API ä»¤ç‰Œ</label>
          <input id="pagesToken" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
        <div class="form-group">
          <label>Zone API ä»¤ç‰Œ</label>
          <input id="zoneToken" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        </div>
        <div style="display:flex; gap:10px; margin-top:24px;">
          <button id="loadConfigBtn" class="btn secondary" style="flex:1;">è¯»å–é…ç½®</button>
          <button id="saveConfigBtn" class="btn primary" style="flex:1;">ä¿å­˜é…ç½®</button>
        </div>

        <div style="height:1px; background:var(--glass-border); margin:30px 0;"></div>

        <div class="form-group">
          <label>é€‰æ‹©é¡¹ç›®ç©ºé—´</label>
          <select id="projectSelect" style="margin-bottom:10px;"><option value="">-- ç­‰å¾…åŠ è½½ --</option></select>
          <button id="loadProjectsBtn" class="btn secondary" style="width:100%;">åˆ·æ–°é¡¹ç›®åˆ—è¡¨</button>
        </div>
      </div>

      <div class="sidebar-footer">
        <span style="font-size:12px; color:var(--text-secondary);">ç³»ç»Ÿæ­£å¸¸</span>
        <button id="themeToggle" class="theme-toggle">â˜€</button>
      </div>
    </div>

    <!-- å†…å®¹åŒº -->
    <div class="content-area">
      <div class="header-bar">
        <h2>åŸŸåç®¡ç†</h2>
        <button id="refreshDomainsBtn" class="btn secondary">åˆ·æ–°çŠ¶æ€</button>
      </div>

      <div id="domainList" class="list-card">
        <div style="display:flex; align-items:center; justify-content:center; height:100%; color:var(--text-secondary); flex-direction:column; gap:8px;">
          <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity:0.3"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
          <span>æš‚æ— åŸŸåæ•°æ®</span>
        </div>
      </div>

      <div class="grid-actions">
        <div class="action-panel">
          <label style="color:var(--accent-blue);">ç»‘å®šæ–°åŸŸå (è‡ªåŠ¨ DNS)</label>
          <div style="display:flex; gap:10px; margin-top:10px;">
            <input id="addDomainInput" placeholder="è¾“å…¥åŸŸå (å¦‚ sub.site.com)" />
            <button id="addDomainBtn" class="btn primary">æ·»åŠ </button>
          </div>
        </div>
        <div class="action-panel">
          <label style="color:var(--danger-color);">è§£ç»‘åŸŸå</label>
          <div style="display:flex; gap:10px; margin-top:10px;">
            <input id="removeDomainInput" placeholder="è¾“å…¥è¦åˆ é™¤çš„åŸŸå" />
            <button id="removeDomainBtn" class="btn danger">åˆ é™¤</button>
          </div>
        </div>
      </div>

      <label>æ“ä½œæ—¥å¿—</label>
      <div id="output" class="log-box">ç­‰å¾…æ“ä½œæŒ‡ä»¤...</div>
    </div>
  </div>

  <script>
    // --- äº¤äº’é€»è¾‘ ---
    const themeToggle = document.getElementById('themeToggle');
    const html = document.documentElement;
    const toast = document.getElementById('toast');
    const toastMsg = document.getElementById('toastMsg');
    const toastIcon = document.getElementById('toastIcon');
    let toastTimer;

    // ä¸»é¢˜åˆ‡æ¢
    themeToggle.addEventListener('click', () => {
      const current = html.getAttribute('data-theme');
      const next = current === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      themeToggle.textContent = next === 'dark' ? 'ğŸŒ™' : 'â˜€';
    });

    // çµåŠ¨å²›é€šçŸ¥
    function showToast(msg, type = 'info') {
      toastMsg.textContent = msg;
      if (type === 'success') toastIcon.textContent = 'âœ“';
      else if (type === 'error') toastIcon.textContent = '!';
      else toastIcon.textContent = 'i';
      
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ç™»å½•é”™è¯¯æŠ–åŠ¨
    function triggerError() {
      const err = document.getElementById('errorMsg');
      const card = document.querySelector('.login-card');
      err.style.opacity = 1;
      card.classList.remove('shake');
      void card.offsetWidth;
      card.classList.add('shake');
    }

    // --- æ ¸å¿ƒ JS é€»è¾‘ (ä¿æŒä¸å˜) ---
    const loginScreen=document.getElementById('loginScreen');
    const mainScreen=document.getElementById('mainScreen');
    const loginPassword=document.getElementById('loginPassword');
    const loginBtn=document.getElementById('loginBtn');

    async function checkLogin(){
      const password=loginPassword.value.trim();
      if(!password) return triggerError();
      try{
        const resp=await fetch('/api/auth',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({password})
        });
        const data=await resp.json();
        if(data.success){
          sessionStorage.setItem('authenticated','true');
          showMainScreen();
        }else{ triggerError(); }
      }catch(e){ triggerError(); }
    }

    function showMainScreen(){
      loginScreen.style.opacity = 0;
      setTimeout(() => {
        loginScreen.classList.add('hidden');
        mainScreen.classList.remove('hidden');
        loadConfig();
      }, 300);
    }

    loginBtn.addEventListener('click',checkLogin);
    loginPassword.addEventListener('keypress',e=>{if(e.key==='Enter')checkLogin();});

    if(sessionStorage.getItem('authenticated')==='true'){
      loginScreen.classList.add('hidden');
      mainScreen.classList.remove('hidden');
      loadConfig();
    }

    const accountId=document.getElementById('accountId');
    const pagesToken=document.getElementById('pagesToken');
    const zoneToken=document.getElementById('zoneToken');
    const projectSelect=document.getElementById('projectSelect');
    const loadProjectsBtn=document.getElementById('loadProjectsBtn');
    const domainList=document.getElementById('domainList');
    const addDomainInput=document.getElementById('addDomainInput');
    const addDomainBtn=document.getElementById('addDomainBtn');
    const removeDomainInput=document.getElementById('removeDomainInput');
    const removeDomainBtn=document.getElementById('removeDomainBtn');
    const refreshDomainsBtn=document.getElementById('refreshDomainsBtn');
    const saveConfigBtn=document.getElementById('saveConfigBtn');
    const loadConfigBtn=document.getElementById('loadConfigBtn');
    const output=document.getElementById('output');

    async function apiCall(path,method='GET',body=null){
      output.innerHTML += `<div>> è¯·æ±‚: ${method} ${path}</div>`;
      output.scrollTop = output.scrollHeight;
      try{
        const resp=await fetch(path,{
          method,
          headers:{
            'Content-Type':'application/json',
            'X-Account-Id':accountId.value.trim(),
            'X-Pages-Token':pagesToken.value.trim(),
            'X-Zone-Token':zoneToken.value.trim()
          },
          body:body?JSON.stringify(body):null
        });
        const data=await resp.json().catch(()=>({error:'å“åº”é”™è¯¯'}));
        output.innerHTML += `<div style="color:${resp.ok?'#34C759':'#FF3B30'}">> ç»“æœ: ${data.success?'æˆåŠŸ':'å¤±è´¥'}</div>`;
        output.scrollTop = output.scrollHeight;
        return{ok:resp.ok,data};
      }catch(e){
        output.innerHTML += `<div style="color:#FF3B30">> é”™è¯¯: ${e.message}</div>`;
        return{ok:false,data:null};
      }
    }

    async function saveConfig(){
      const config={accountId:accountId.value.trim(),pagesToken:pagesToken.value.trim(),zoneToken:zoneToken.value.trim()};
      if(!config.accountId||!config.pagesToken||!config.zoneToken) return showToast('è¯·å¡«å†™æ‰€æœ‰é…ç½®', 'error');
      const res=await fetch('/api/config',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(config)});
      const data=await res.json();
      showToast(data.success?'é…ç½®å·²ä¿å­˜':'ä¿å­˜å¤±è´¥', data.success?'success':'error');
    }

    async function loadConfig(){
      const res=await fetch('/api/config');
      const data=await res.json();
      if(data.success&&data.config){
        accountId.value=data.config.accountId||'';
        pagesToken.value=data.config.pagesToken||'';
        zoneToken.value=data.config.zoneToken||'';
        output.innerHTML += `<div>> å·²åŠ è½½é…ç½®</div>`;
      }
    }

    async function loadProjects(){
      const acc=accountId.value.trim();
      if(!acc||!pagesToken.value.trim()) return showToast('é…ç½®ä¸å®Œæ•´', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects`);
      if(res.ok&&res.data.success){
        const projects=res.data.result||[];
        projectSelect.innerHTML=projects.map(p=>`<option value="${p.name}">${p.name}</option>`).join('');
        if(projects.length>0){
          projectSelect.value=projects[0].name;
          await loadDomains();
        }
        showToast('é¡¹ç›®å·²æ›´æ–°', 'success');
      }
    }

    async function loadDomains(){
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      if(!acc||!proj)return;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`);
      domainList.innerHTML='';
      if(res.ok&&res.data.success){
        const domains=res.data.result||[];
        if(domains.length===0){
          domainList.innerHTML='<div style="display:flex;height:100%;align-items:center;justify-content:center;color:var(--text-secondary);">æš‚æ— åŸŸå</div>';
        }else{
          domains.forEach(d=>{
            const isAct = d.status==='active';
            const el=document.createElement('div');
            el.className='list-item';
            el.innerHTML=`
              <div style="display:flex;align-items:center;">
                <span style="font-weight:500">${d.name}</span>
                <span class="status-badge ${isAct?'badge-active':'badge-pending'}">${isAct?'å·²æ¿€æ´»':'éªŒè¯ä¸­'}</span>
              </div>
              <button class="btn secondary" style="padding:6px 14px; border-radius:14px; font-size:12px;" onclick="confirmAndRemove('${encodeURIComponent(d.name)}')">æ–­å¼€</button>
            `;
            domainList.appendChild(el);
          });
        }
      }
    }

    window.confirmAndRemove=async function(domainEncoded){
      const domain=decodeURIComponent(domainEncoded);
      if(!confirm(`ç§»é™¤åŸŸå ${domain}?`))return;
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        await loadDomains();
        showToast('åˆ é™¤æˆåŠŸ', 'success');
      } else { showToast('åˆ é™¤å¤±è´¥', 'error'); }
    };

    addDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=addDomainInput.value.trim();
      if(!acc||!proj||!domain) return showToast('è¯·æ£€æŸ¥è¾“å…¥', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains`,'POST',{name:domain});
      if(res.ok&&res.data.success){
        addDomainInput.value='';
        await loadDomains();
        showToast(res.data.dns_created?'åŸŸååŠDNSå·²æ·»åŠ ':'åŸŸåå·²æ·»åŠ ', 'success');
      } else { showToast('æ·»åŠ å¤±è´¥', 'error'); }
    });

    removeDomainBtn.addEventListener('click',async()=>{
      const acc=accountId.value.trim();
      const proj=projectSelect.value;
      const domain=removeDomainInput.value.trim();
      if(!acc||!proj||!domain) return showToast('è¯·è¾“å…¥åŸŸå', 'error');
      const res=await apiCall(`/api/accounts/${encodeURIComponent(acc)}/projects/${encodeURIComponent(proj)}/domains/${domain}`,'DELETE');
      if(res.ok&&res.data.success){
        removeDomainInput.value='';
        await loadDomains();
        showToast('åˆ é™¤æˆåŠŸ', 'success');
      } else { showToast('åˆ é™¤å¤±è´¥', 'error'); }
    });

    refreshDomainsBtn.addEventListener('click',() => { loadDomains(); showToast('å·²åˆ·æ–°'); });
    loadProjectsBtn.addEventListener('click',loadProjects);
    projectSelect.addEventListener('change',loadDomains);
    saveConfigBtn.addEventListener('click',saveConfig);
    loadConfigBtn.addEventListener('click',loadConfig);
  </script>
</body>
</html>
